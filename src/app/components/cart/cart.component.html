<app-header></app-header>
<div class="cart-page-container">
  <!-- Breadcrumb -->
  <div class="breadcrumb-container">
    <div class="container">
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a routerLink="/">Trang chủ</a></li>
          <li class="breadcrumb-item active" aria-current="page">Giỏ hàng</li>
        </ol>
      </nav>
    </div>
  </div>

  <!-- Main Content -->
  <div class="container mt-4">
    <div class="row">
      <!-- Cart Items -->
      <div class="col-lg-8">
        <div class="cart-header">
          <h1 class="page-title">Giỏ hàng của bạn</h1>
        </div>

        <!-- Loading state -->
        <div *ngIf="isCartLoading" class="loading-container text-center py-5">
          <div class="spinner-border text-warning" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
          <p class="mt-3">Đang tải giỏ hàng...</p>
        </div>

        <!-- Empty Cart Message -->
        <div *ngIf="!isCartLoading && cartItems.length === 0" class="empty-cart text-center py-5">
          <i class="fas fa-shopping-basket fa-4x text-muted mb-3"></i>
          <h4>Giỏ hàng của bạn đang trống</h4>
          <p>Bạn chưa thêm sản phẩm nào vào giỏ hàng</p>
          <button class="btn btn-primary mt-3" (click)="continueShopping()">Tiếp tục mua sắm</button>
        </div>
    
        <!-- Cart Items List -->
        <div *ngIf="!isCartLoading && cartItems.length > 0" class="cart-items">
          <div *ngFor="let item of cartItems" class="cart-item mb-3">
            <div class="row align-items-center">
              <div class="col-md-2">
                <img [src]="item.pizza?.url || item.image || 'assets/image/placeholder-pizza.jpg'" 
                     [alt]="item.name" 
                     (error)="handleImageError($event)" 
                     class="img-fluid">
              </div>
              <div class="col-md-4">
                <h5 class="item-name">{{ item.name || 'Pizza' }}</h5>
                <p class="item-options">Size: {{ item.size || 'Unknown' }}, Loại: {{ item.type || 'Unknown' }}</p>
              </div>
              <div class="col-md-2">
                <div class="quantity-control">
                  <button class="btn-quantity" (click)="updateCartItemQuantity(item, -1)" [disabled]="item.quantity <= 1">-</button>
                  <input type="number" 
                         class="quantity-input" 
                         [value]="item.quantity" 
                         (change)="setCartItemQuantity(item, $event)" 
                         min="1" 
                         max="50">
                  <button class="btn-quantity" (click)="updateCartItemQuantity(item, 1)" [disabled]="item.quantity >= 50">+</button>
                </div>
              </div>
              <div class="col-md-2">
                <div class="item-price">{{ formatPrice(item.price * item.quantity) }}</div>
              </div>
              <div class="col-md-2">
                <button class="btn-remove" (click)="removeCartItem(item)">
                  <i class="fas fa-trash"></i> Xóa
                </button>
              </div>
            </div>
          </div>
          
          <!-- Clear Cart Button -->
          <div *ngIf="cartItems.length > 0" class="d-flex justify-content-end my-3">
            <button class="btn btn-outline-danger" (click)="clearCart()">
              <i class="fas fa-trash"></i> Xóa tất cả
            </button>
          </div>
        </div>
      </div>

      <!-- Order Summary -->
      <div class="col-lg-4" *ngIf="!isCartLoading && cartItems.length > 0">
        <div class="order-summary">
          <h4 class="summary-title">Tóm tắt đơn hàng</h4>
          <div class="summary-details">
            <div class="summary-row">
              <span>Tạm tính</span>
              <span>{{ formatPrice(subtotal) }}</span>
            </div>
            <div class="summary-row">
              <span>Phí vận chuyển</span>
              <span>{{ formatPrice(shippingFee) }}</span>
            </div>
            <div class="summary-row total">
              <span>Tổng cộng</span>
              <span>{{ formatPrice(total) }}</span>
            </div>
          </div>
          <button class="btn-checkout" (click)="proceedToCheckout()">Thanh toán</button>
          <button class="btn-continue" (click)="continueShopping()">Tiếp tục mua hàng</button>
        </div>
      </div>
    </div>
  </div>
</div>
<app-footer></app-footer>
